# VNPY åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿ

åŸºäº VNPY æ¡†æ¶æ„å»ºçš„åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿï¼Œé›†æˆ TimescaleDB æ—¶åºæ•°æ®åº“å’Œ OKX äº¤æ˜“æ‰€æ¥å£ã€‚ä½¿ç”¨ç°ä»£ Python åŒ…ç®¡ç†å·¥å…· `uv` è¿›è¡Œä¾èµ–ç®¡ç†ã€‚

## ğŸš€ ç‰¹æ€§

- **VNPY æ¡†æ¶**: åŸºäºä¸šç•Œé¢†å…ˆçš„ VNPY é‡åŒ–äº¤æ˜“æ¡†æ¶
- **TimescaleDB**: æ—¶åºæ•°æ®åº“ï¼Œä¸“ä¸ºäº¤æ˜“æ•°æ®ä¼˜åŒ–
- **OKX é›†æˆ**: åŸç”Ÿæ”¯æŒ OKX äº¤æ˜“æ‰€ API
- **å®¹å™¨åŒ–éƒ¨ç½²**: å®Œæ•´çš„ Docker Compose éƒ¨ç½²æ–¹æ¡ˆ
- **ç°ä»£åŒ–å·¥å…·**: ä½¿ç”¨ uv è¿›è¡Œ Python åŒ…ç®¡ç†
- **å¤šæœåŠ¡æ¶æ„**: ä¸»åº”ç”¨ã€æ•°æ®é‡‡é›†å™¨ã€Web ç•Œé¢åˆ†ç¦»
- **ç›‘æ§é¢æ¿**: é›†æˆ Grafana ç›‘æ§å’Œå¯è§†åŒ–

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VNPY Trader   â”‚    â”‚ Data Collector  â”‚    â”‚   Web Trader    â”‚
â”‚   (ä¸»äº¤æ˜“åº”ç”¨)    â”‚    â”‚   (æ•°æ®é‡‡é›†)      â”‚    â”‚   (Webç•Œé¢)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚           â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TimescaleDB   â”‚ â”‚    Redis    â”‚ â”‚   OKX Gateway   â”‚ â”‚     Grafana     â”‚
â”‚   (æ—¶åºæ•°æ®åº“)    â”‚ â”‚   (ç¼“å­˜)     â”‚ â”‚   (äº¤æ˜“æ¥å£)     â”‚ â”‚    (ç›‘æ§é¢æ¿)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

- Python 3.11+
- Docker & Docker Compose
- uv (Python åŒ…ç®¡ç†å™¨)
- 4GB+ RAM
- 20GB+ ç£ç›˜ç©ºé—´

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd vnpy-crypto-trader
```

### 2. å®‰è£… uv (å¦‚æœå°šæœªå®‰è£…)

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp config.env.template .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä½ çš„ OKX API å¯†é’¥
vim .env
```

### 4. ä½¿ç”¨ uv å®‰è£…ä¾èµ–

```bash
# å®‰è£…ä¸»è¦ä¾èµ–
uv sync

# å®‰è£…å¼€å‘ä¾èµ–
uv sync --group dev

# å®‰è£… Jupyter æ”¯æŒ
uv sync --group jupyter
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 6. è®¿é—®æœåŠ¡

- **ä¸»åº”ç”¨**: åœ¨å®¹å™¨ä¸­è¿è¡Œ
- **Web äº¤æ˜“ç•Œé¢**: http://localhost:8080
- **Jupyter Lab**: http://localhost:8888
- **Grafana ç›‘æ§**: http://localhost:3000 (admin/admin2024)

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### æœ¬åœ°å¼€å‘

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
uv venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
uv sync --group dev --group jupyter

# è¿è¡Œä¸»åº”ç”¨
uv run vnpy-crypto

# è¿è¡Œæ•°æ®é‡‡é›†å™¨
uv run vnpy-collector

# è¿è¡Œ Web ç•Œé¢
uv run vnpy-web

# æˆ–è€…ä½¿ç”¨ scriptsï¼ˆå…¼å®¹æ€§ï¼‰
uv run python scripts/main.py
uv run python scripts/data_collector.py
uv run python scripts/start_webtrader.py
```

### ä»£ç è´¨é‡å·¥å…·

```bash
# ä»£ç æ ¼å¼åŒ–
uv run black .

# å¯¼å…¥æ’åº
uv run isort .

# ä»£ç æ£€æŸ¥
uv run flake8 .

# ç±»å‹æ£€æŸ¥
uv run mypy .

# è¿è¡Œæµ‹è¯•
uv run pytest
```

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### TimescaleDB è¡¨ç»“æ„

- `bar_data`: Kçº¿æ•°æ® (è¶…è¡¨)
- `tick_data`: é€ç¬”æ•°æ® (è¶…è¡¨)
- `orders`: è®¢å•æ•°æ®
- `trades`: æˆäº¤æ•°æ®
- `positions`: æŒä»“æ•°æ®
- `accounts`: è´¦æˆ·æ•°æ®
- `strategies`: ç­–ç•¥é…ç½®
- `strategy_logs`: ç­–ç•¥æ—¥å¿— (è¶…è¡¨)

### æ•°æ®ä¿ç•™ç­–ç•¥

- Tick æ•°æ®: 3ä¸ªæœˆ
- åˆ†é’Ÿçº§ Bar æ•°æ®: 1å¹´
- ç­–ç•¥æ—¥å¿—: 6ä¸ªæœˆ

## ğŸ”‘ OKX API é…ç½®

1. ç™»å½• OKX è´¦æˆ·
2. è¿›å…¥ API ç®¡ç†é¡µé¢
3. åˆ›å»ºæ–°çš„ API å¯†é’¥
4. è®¾ç½®æƒé™: è¯»å–ã€äº¤æ˜“
5. å°†å¯†é’¥ä¿¡æ¯å¡«å…¥ `.env` æ–‡ä»¶

### API æƒé™è¯´æ˜

- **è¯»å–æƒé™**: è·å–è´¦æˆ·ä¿¡æ¯ã€å¸‚åœºæ•°æ®
- **äº¤æ˜“æƒé™**: ä¸‹å•ã€æ’¤å•ã€æŸ¥è¯¢è®¢å•
- **æç°æƒé™**: ä¸å»ºè®®å¼€å¯

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶

- `logs/vnpy_main.log`: ä¸»åº”ç”¨æ—¥å¿—
- `logs/data_collector.log`: æ•°æ®é‡‡é›†æ—¥å¿—
- `logs/webtrader.log`: Web ç•Œé¢æ—¥å¿—

### Grafana ä»ªè¡¨æ¿

ç³»ç»Ÿæä¾›é¢„é…ç½®çš„ Grafana ä»ªè¡¨æ¿ï¼Œç›‘æ§:

- äº¤æ˜“æ•°æ®ç»Ÿè®¡
- ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- API è°ƒç”¨é¢‘ç‡
- é”™è¯¯ç‡ç»Ÿè®¡

## ğŸ¯ ç­–ç•¥å¼€å‘

### åˆ›å»ºæ–°ç­–ç•¥

```python
from vnpy_ctastrategy import CtaTemplate, CtaEngine
from vnpy.trader.object import TickData, BarData

class MyStrategy(CtaTemplate):
    """ç¤ºä¾‹ç­–ç•¥"""
    
    # ç­–ç•¥å‚æ•°
    fast_window = 10
    slow_window = 20
    
    def __init__(self, cta_engine: CtaEngine, strategy_name: str, vt_symbol: str, setting: dict):
        super().__init__(cta_engine, strategy_name, vt_symbol, setting)
    
    def on_tick(self, tick: TickData):
        """Tickæ•°æ®æ¨é€"""
        pass
    
    def on_bar(self, bar: BarData):
        """Baræ•°æ®æ¨é€"""
        pass
```

### ç­–ç•¥æ¨¡æ¿

- CTAç­–ç•¥: é€‚ç”¨äºè¶‹åŠ¿è·Ÿè¸ª
- å¥—åˆ©ç­–ç•¥: é€‚ç”¨äºè·¨å“ç§å¥—åˆ©
- åšå¸‚ç­–ç•¥: é€‚ç”¨äºæä¾›æµåŠ¨æ€§

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# uv åŒ…ç®¡ç†
uv add package_name          # æ·»åŠ ä¾èµ–
uv remove package_name       # ç§»é™¤ä¾èµ–
uv sync                      # åŒæ­¥ä¾èµ–
uv run command              # è¿è¡Œå‘½ä»¤

# åº”ç”¨å¯åŠ¨
uv run vnpy-crypto          # å¯åŠ¨ä¸»åº”ç”¨
uv run vnpy-collector       # å¯åŠ¨æ•°æ®é‡‡é›†å™¨
uv run vnpy-web             # å¯åŠ¨ Web ç•Œé¢

# Docker æ“ä½œ
docker-compose up -d         # å¯åŠ¨æœåŠ¡
docker-compose down          # åœæ­¢æœåŠ¡
docker-compose logs -f       # æŸ¥çœ‹æ—¥å¿—
docker-compose restart      # é‡å¯æœåŠ¡

# æ•°æ®åº“æ“ä½œ
docker exec -it vnpy-timescaledb psql -U vnpy -d vnpy_crypto
```

## ğŸ“ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶

- `pyproject.toml`: Python é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†
- `docker-compose.yml`: å®¹å™¨ç¼–æ’é…ç½®
- `src/vnpy_cry/config/settings.py`: VNPY ä¸»é…ç½®
- `config/database/postgresql.conf`: æ•°æ®åº“é…ç½®

### é¡¹ç›®ç»“æ„

```
vnpy-cry/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ vnpy_cry/              # ä¸»è¦åº”ç”¨åŒ…
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ core/              # æ ¸å¿ƒæ¨¡å—
â”‚       â”‚   â”œâ”€â”€ main.py        # ä¸»åº”ç”¨
â”‚       â”‚   â”œâ”€â”€ data_collector.py  # æ•°æ®é‡‡é›†å™¨
â”‚       â”‚   â””â”€â”€ web_trader.py  # Web äº¤æ˜“ç•Œé¢
â”‚       â”œâ”€â”€ config/            # é…ç½®æ¨¡å—
â”‚       â”‚   â””â”€â”€ settings.py    # ç³»ç»Ÿé…ç½®
â”‚       â”œâ”€â”€ strategies/        # äº¤æ˜“ç­–ç•¥
â”‚       â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ data/              # æ•°æ®å¤„ç†
â”œâ”€â”€ scripts/                   # å¯åŠ¨è„šæœ¬ï¼ˆå…¼å®¹æ€§ï¼‰
â”œâ”€â”€ config/                    # å¤–éƒ¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ database/                  # æ•°æ®åº“ç›¸å…³
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docker-compose.yml
```

### ç¯å¢ƒå˜é‡

æ‰€æœ‰æ•æ„Ÿé…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†ï¼Œæ”¯æŒ:

- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- API å¯†é’¥
- æ—¥å¿—çº§åˆ«
- æœåŠ¡ç«¯å£

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥å®‰å…¨**: ä¸è¦å°†çœŸå® API å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **èµ„é‡‘ç®¡ç†**: å»ºè®®å…ˆåœ¨æ¨¡æ‹Ÿç¯å¢ƒæµ‹è¯•
3. **é£é™©æ§åˆ¶**: è®¾ç½®åˆç†çš„æ­¢æŸå’Œä»“ä½ç®¡ç†
4. **ç³»ç»Ÿç›‘æ§**: å…³æ³¨ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
5. **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½é‡è¦çš„ç­–ç•¥å’Œé…ç½®æ•°æ®

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [VNPY å®˜æ–¹æ–‡æ¡£](https://vnpy.com)
- [TimescaleDB æ–‡æ¡£](https://docs.timescale.com)
- [OKX API æ–‡æ¡£](https://www.okx.com/docs-v5/)
- [uv æ–‡æ¡£](https://docs.astral.sh/uv/)

---

**å…è´£å£°æ˜**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…äº¤æ˜“é£é™©ã€‚ 